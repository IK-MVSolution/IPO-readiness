# โครงสร้างการคำนวณคะแนน (Scoring Structure)

สรุปจาก `backend/ipo_readiness/services/metrics_engine.py`

---

## 1. ขั้นตอนรวม (Overall Flow)

```
ข้อมูล Excel (งบดุล, งบกำไรขาดทุน, อัตราส่วน)
    ↓
ตรวจจับหน่วย (บาท / พันบาท / ล้านบาท)
    ↓
คำนวณ/ดึงอัตราส่วน (ROA, ROE, margin, D/E, ...)
    ↓
┌─────────────────────────────────────────────────────────────┐
│ 1) เกณฑ์ IPO (SET / mai)  → ผ่าน/ไม่ผ่าน 5 ข้อ            │
│ 2) คะแนนสุขภาพทางการเงิน   → 7 ตัวชี้วัด, รวมคะแนน 12 คะแนน │
│ 3) ระดับความพร้อม IPO     → 25 / 50 / 75 / 100             │
│ 4) คำแนะนำ                 → จากเกณฑ์ไม่ผ่าน + อัตราส่วนอ่อน │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. เกณฑ์ IPO (แบบผ่าน/ไม่ผ่าน)

- ใช้ค่าจาก **ปีล่าสุด** และ **กำไรสะสม 2–3 ปีล่าสุด** (แปลงเป็นบาทด้วย `unit_multiplier`)
- แต่ละข้อ: ผ่าน = นับ 1, ไม่ผ่าน = 0
- SET ผ่านครบ 5 ข้อ → ถือว่าพร้อม SET; mai ผ่านครบ 5 ข้อ → ถือว่าพร้อม mai

| ลำดับ | เกณฑ์ | วิธีคำนวณ/ดึงค่า | SET | mai |
|-------|--------|-------------------|-----|-----|
| 1 | ส่วนของผู้ถือหุ้น | ค่าล่าสุดจาก `shareholders_equity` × unit_multiplier | ≥ 800 ล้าน | ≥ 100 ล้าน |
| 2 | กำไรสุทธิปีล่าสุด | ค่าล่าสุดจาก `net_profit` × unit_multiplier | ≥ 75 ล้าน | ≥ 25 ล้าน |
| 3 | กำไรสุทธิรวม 2–3 ปี | ผลรวม 2–3 ปีล่าสุดของ `net_profit` × unit_multiplier | ≥ 125 ล้าน | ≥ 40 ล้าน |
| 4 | ผลการดำเนินงาน (ปี) | จำนวนปีที่มีข้อมูล `net_profit` | ≥ 3 ปี | ≥ 2 ปี |
| 5 | มีกำไรในงวดสะสม | กำไรปีล่าสุด > 0 | ใช่ | ใช่ |

- **pass_count** = จำนวนข้อที่ผ่าน (0–5)  
- **passed** = ผ่านครบทั้ง 5 ข้อ

---

## 3. คะแนนระดับความพร้อม IPO (Readiness Score)

- **ไม่ใช้การบวกคะแนน** แต่ใช้กฎจากผล SET/mai และจำนวนข้อที่ผ่าน:

| เงื่อนไข | ระดับความพร้อม | คะแนน (readiness_score) |
|----------|-----------------|---------------------------|
| ผ่านเกณฑ์ SET ครบ 5 ข้อ | พร้อมสำหรับ SET | **100** |
| ผ่านเกณฑ์ mai ครบ 5 ข้อ (แต่ไม่ผ่าน SET) | พร้อมสำหรับ mai | **75** |
| ผ่าน mai ไม่ครบ แต่ pass_count ≥ 3 | ใกล้พร้อม | **50** |
| อื่นๆ | ต้องพัฒนาเพิ่มเติม | **25** |

---

## 4. คะแนนสุขภาพทางการเงิน (Financial Health Score)

- ใช้เฉพาะ **ค่าปีล่าสุด** ของแต่ละอัตราส่วน
- แต่ละตัวชี้วัดได้ **0 ถึง max_points** แล้วนำไปรวม
- **คะแนนรวมสูงสุด = 12** (2+2+2+2+2+1+1)
- **เปอร์เซ็นต์** = (คะแนนรวม / 12) × 100
- **ระดับสุขภาพ** มาจากเปอร์เซ็นต์:
  - ≥ 80% → ดีมาก  
  - ≥ 60% → ดี  
  - ≥ 40% → พอใช้  
  - &lt; 40% → ต้องปรับปรุง  

### 4.1 ตัวชี้วัดและเกณฑ์ให้คะแนน

| ลำดับ | ตัวชี้วัด | คะแนนเต็ม | ชนิด | เกณฑ์ (good / fair) | ระดับ |
|-------|-----------|-----------|------|----------------------|--------|
| 1 | **ROA (%)** | 2 | ยิ่งมากยิ่งดี | ≥ 8% → ดีมาก; ≥ 3% → พอใช้; &lt; 3% → ต้องปรับปรุง | ดีมาก=2, พอใช้=1, ต้องปรับปรุง=0 |
| 2 | **ROE (%)** | 2 | ยิ่งมากยิ่งดี | ≥ 15% → ดีมาก; ≥ 8% → พอใช้; &lt; 8% → ต้องปรับปรุง | เหมือนบน |
| 3 | **Current Ratio (เท่า)** | 2 | กลางดีที่สุด | 1.2–3.0 → ดีมาก; 1.0–1.2 หรือ 3.0–5.0 → พอใช้; นอกช่วง → ต้องปรับปรุง | เหมือนบน |
| 4 | **D/E Ratio (เท่า)** | 2 | ยิ่งน้อยยิ่งดี | ≤ 1.0 → ดีมาก; ≤ 1.5 → พอใช้; &gt; 1.5 → ต้องปรับปรุง | เหมือนบน |
| 5 | **Debt to Assets** (อัตราส่วน 0–1) | 2 | ยิ่งน้อยยิ่งดี | ≤ 0.6 → ดีมาก; ≤ 0.75 → พอใช้; &gt; 0.75 → ต้องปรับปรุง | เหมือนบน |
| 6 | **Gross Margin (%)** | 1 | ยิ่งมากยิ่งดี | ≥ 25% → ดีมาก; ≥ 15% → พอใช้; &lt; 15% → ต้องปรับปรุง | ดีมาก=1, พอใช้=1, ต้องปรับปรุง=0 |
| 7 | **Net Margin (%)** | 1 | ยิ่งมากยิ่งดี | ≥ 12% → ดีมาก; ≥ 6% → พอใช้; &lt; 6% → ต้องปรับปรุง | เหมือนบน |

### 4.2 สูตรระดับ (ในโค้ด)

- **ยิ่งมากยิ่งดี (positive bands):**  
  - value ≥ good → ได้เต็ม, ระดับ "ดีมาก"  
  - value ≥ fair → ได้ max_points−1 (อย่างน้อย 1), ระดับ "พอใช้"  
  - value &lt; fair → 0 คะแนน, ระดับ "ต้องปรับปรุง"

- **ยิ่งน้อยยิ่งดี (inverse bands):**  
  - value ≤ good → ได้เต็ม, "ดีมาก"  
  - value ≤ fair → ได้ max_points−1, "พอใช้"  
  - value &gt; fair → 0, "ต้องปรับปรุง"

- **Current Ratio (กลางดีที่สุด):**  
  - 1.2 ≤ value ≤ 3.0 → เต็ม, "ดีมาก"  
  - 1.0 ≤ value &lt; 1.2 หรือ 3.0 &lt; value ≤ 5.0 → พอใช้  
  - นอกช่วง → "ต้องปรับปรุง"

---

## 5. การสร้างคำแนะนำ (Recommendations)

- **จากเกณฑ์ IPO ที่ไม่ผ่าน (mai):**  
  - ส่วนของผู้ถือหุ้นไม่ผ่าน → แนะนำเพิ่มส่วนของผู้ถือหุ้นอีก X  
  - กำไรปีล่าสุดไม่ผ่าน → แนะนำเพิ่มกำไรอีก X  
  - กำไรรวม 2–3 ปีไม่ผ่าน → แนะนำกำไรสะสมยังขาดอีก X  
  - ผลการดำเนินงานไม่ผ่าน → แนะนำต้องมีผลการดำเนินงานอีก X ปี  
  - งวดสะสมขาดทุน → แนะนำต้องมีกำไรในงวดสะสม  

- **จากอัตราส่วนระดับ "ต้องปรับปรุง":**  
  - Current Ratio → แนะนำให้อยู่ช่วง 1.2–3.0  
  - D/E → แนะนำให้ ≤ 1.0  
  - ROE → แนะนำให้ ≥ 15%  

- **การเรียง:** เรียงตามความสำคัญ (สูง → กลาง → ต่ำ) แล้วค่อยแสดง

---

## 6. สรุปตัวเลขสำคัญ

| รายการ | ค่า |
|--------|-----|
| จำนวนเกณฑ์ IPO (ต่อตลาด) | 5 ข้อ |
| คะแนนสุขภาพทางการเงิน (คะแนนเต็ม) | 12 |
| ระดับความพร้อม (คะแนน) | 25, 50, 75, 100 |
| ระดับสุขภาพทางการเงิน | ดีมาก / ดี / พอใช้ / ต้องปรับปรุง (จาก % ของ 12 คะแนน) |

ถ้าต้องการให้ช่วยดึงเฉพาะส่วนไหนไปใส่ในวิทยานิพนธ์/บทความ (เช่น แค่ตารางเกณฑ์ หรือแค่สูตรระดับ) บอกได้ครับ
